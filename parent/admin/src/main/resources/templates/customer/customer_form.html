<!DOCTYPE html>
<html lang="en">
<head th:replace="~{form_fragments :: head('Update Customer')}"></head>
<body>
<header th:replace="~{navigations :: header()}"></header>

<main class="content">
    <div class="container mt-4">
        <h1 class="text-center" th:text="${'Edit Customer [ID:' + customer.id + ']'}"></h1>
        <form id="mainForm" th:action="@{/users/save}" method="POST" th:object="${customer}">

            <div class="mx-auto mt-5">
                <div class="border border-1 rounded-3 px-4 pb-4 shadow-sm row g-3">
                    <input th:replace="~{form_fragments :: hidden_input('id')}"/>
                    <th:block th:replace="~{form_fragments :: text_input('Email address', 'email', false)}"></th:block>
                    <th:block th:replace="~{form_fragments :: text_input('First name', 'firstName', false)}"></th:block>
                    <th:block th:replace="~{form_fragments :: text_input('Last name', 'lastName', false)}"></th:block>

                    <th:block th:replace="~{form_fragments :: password_input(${customer.id})}"></th:block>
                    <th:block th:replace="~{form_fragments :: confirm_password_input(${customer.id})}"></th:block>

                    <th:block
                            th:replace="~{form_fragments :: checkbox_input('Enabled', 'enabled', ${customer.enabled}, false)}"></th:block>
                    <th:block
                            th:replace="~{form_fragments :: checkbox_input('Email verified', 'emailVerified', ${customer.emailVerified}, false)}"></th:block>


                    <label class="col-form-label col-sm-4">Addresses</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="addresses">
                            <option th:value="${address.id}" th:each="address : *{addresses}"
                                    th:text="${address.fullAddress}"></option>
                        </select>
                    </div>

                    <div th:id="${'addressContainer' + address.id}" class="col-sm-8 offset-sm-4 g-3 row d-none"
                         th:each="address, stat : *{addresses}">
                        <input type="hidden" th:name="${'addresses[' + stat.index + '].id'}" th:value="${address.id}"/>
                        <input type="hidden" th:name="${'addresses[' + stat.index + '].customer'}"
                               th:value="${address.customer.id}"/>

                        <th:block
                                th:replace="~{form_fragments :: text_input('Phone number', 'addresses[' + ${stat.index} + '].phoneNumber', false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: text_input('First name', 'addresses[' + ${stat.index} + '].firstName', false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: text_input('Last name', 'addresses[' + ${stat.index} + '].lastName', false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: checkbox_input('Primary', 'addresses[' + ${stat.index} + '].primary', ${address.primary}, false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: text_input('Address Line 1', 'addresses[' + ${stat.index} + '].addressLine1', false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: text_input('Address Line 2', 'addresses[' + ${stat.index} + '].addressLine2', false)}"></th:block>

                        <label class="col-form-label col-sm-4">Country</label>
                        <div class="col-sm-8">
                            <select th:field="*{addresses[__${stat.index}__].country}" class="form-control"
                                    th:data-address-id="${address.id}">
                                <option th:each="country : ${countryList}" th:value="${country.id}"
                                        th:text="${country.name}"></option>
                            </select>
                        </div>

                        <label class="col-form-label col-sm-4">Datalist example</label>
                        <div class="col-sm-8">
                            <input class="form-control" th:list="${'states' + address.id}"
                                   placeholder="Type to search...">
                            <datalist th:id="${'states' + address.id}" class="states"></datalist>
                        </div>

                        <th:block
                                th:replace="~{form_fragments :: text_input('City', 'addresses[' + ${stat.index} + '].city', false)}"></th:block>
                        <th:block
                                th:replace="~{form_fragments :: text_input('Postal code', 'addresses[' + ${stat.index} + '].postalCode', false)}"></th:block>
                    </div>
                </div>

                <div th:replace="~{form_fragments :: form_buttons(${customer})}"></div>
            </div>
        </form>
    </div>
</main>

<footer th:replace="~{navigations :: footer()}"></footer>

<script type="text/javascript" th:src="@{/js/customer_form.js}"></script>
<script type="text/javascript">
    const MODULE_URL = "[[@{/}]]";
    const MAX_FILE_SIZE = "0";
</script>
</body>
</html>